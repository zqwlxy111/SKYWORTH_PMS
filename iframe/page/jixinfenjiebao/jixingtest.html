<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>项目总览</title>
    <link rel="stylesheet" href="/SKYWORTH_PMS/iframe/assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="/SKYWORTH_PMS/iframe/assets/module/admin.css?v=312"/>
    <link rel="stylesheet" href="/SKYWORTH_PMS/iframe/assets/module/steps/style.css">
    <!--    <link rel="stylesheet" href="/SKYWORTH_PMS/iframe/assets/libs/elementUi/element.css"/>-->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        #step_demo {
            padding-top: 15px;
        }

        .layui-timeline {
            width: 66%;
            /*border: 1px solid red;*/
            margin: 26px 0 0 16px;
        }

        .layui-timeline-item {
            padding-right: 15px;
            margin-bottom: 35px;
        }

        .el-step.is-simple .el-step__title {
            font-size: 13px;
        }

        .el-step__title.is-process {
            font-weight: 300;
        }
    /*    lingshi*/
        .el-steps{
            margin-bottom: 50px;
        }
    </style>
</head>
<body>

<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header">项目机型分解包查询</div>
        <div class="layui-card-body">
            <div class="layui-form toolbar" id="toolbarShow">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label w-auto">项目选择：</label>
                        <div class="layui-input-inline mr0">
                            <select id="xiangmuxuanze" name="xiangmuxuanze" lay-filter="xiangmuxuanze"
                                    lay-verType="tips" lay-verify="required">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label w-auto">机型选择：</label>
                        <div class="layui-input-inline mr0">
                            <select id="jixingxuanze" name="jixingxuanze" lay-filter="jixingxuanze"
                                    lay-verType="tips" lay-verify="required">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                    <!--<div class="layui-inline" style="margin-left: 6px">
                        <button class="layui-btn icon-btn" lay-filter="formSubSearchMachine" lay-submit>
                            <i class="layui-icon">&#xe615;</i>搜索
                        </button>
                    </div>-->
                </div>
            </div>

            <!--            橙色标签线-->
            <hr class="layui-bg-green">

            <!--            vue-->
            <div id="app" style="line-height: 0px" class="layui-hide">
                <el-steps :active="0" finish-status="success" simple>
                    <el-step v-bind:title="item.name" v-for="item in datass"></el-step>
                </el-steps>
                <div class="block">
                    <el-timeline :reverse="reverse">
                        <el-timeline-item v-for="(activity, index) in activities" >{{activity.content}}</el-timeline-item>
                    </el-timeline>
                </div>
            </div>

            <button id="goBtn" style="visibility: hidden">跳转的指定的步骤</button>
        </div>
    </div>
    <!--<div class="layui-form">
        <div class="layui-form-item">
            <ul class="layui-timeline">
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">
                            <div class="layui-col-lg3">2017年，layui 里程碑版本 2.0 发布</div>
                            <div class="layui-col-lg3" style="margin-top: -8px ">
                                <div class="layui-input-inline">
                                    <select id="fenjiebaojiedian1" name="fenjiebaojiedian" lay-filter="fenjiebaojiedian"
                                            lay-verType="tips" lay-verify="required">
                                        <option value="">请选择</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>-->
</div>

<!-- js部分 -->
<script type="text/javascript" src="/SKYWORTH_PMS/iframe/assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="/SKYWORTH_PMS/iframe/assets/js/jquery-2.2.4.min.js"></script>
<script src="/SKYWORTH_PMS/iframe/assets/libs/vue/vue.js"></script>
<script src="/SKYWORTH_PMS/iframe/assets/libs/elementUi/element.js"></script>
<!--<script src="https://unpkg.com/element-ui/lib/index.js"></script>-->
<script type="text/javascript" src="/SKYWORTH_PMS/iframe/assets/js/common.js?v=312"></script>
<script type="text/javascript" src="/SKYWORTH_PMS/iframe/assets/js/util.js"></script>
<script type="text/javascript" src="/SKYWORTH_PMS/iframe/assets/js/api.js"></script>

<!--自定义js-->
<script>
    layui.use(['layer', 'form', 'table', 'laydate', 'admin', 'index', 'jquery', 'steps'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form;
        var table = layui.table;
        var util = layui.util;
        var laydate = layui.laydate;
        var admin = layui.admin;
        var index = layui.index;

        // 项目选择下拉框渲染
        api.project.getList({}, function (e) {
            console.log(e);
            for (var i = 0; i < e.length; i++) {
                var xiangmuxuanze = $("#xiangmuxuanze");
                xiangmuxuanze.append("<option value='" + e[i].name + "'>" + e[i].name + "</option>");
            }
            form.render();
        });

        // 机型选择下拉框渲染
        var blId = null; // 项目选择索引值 -- 给submit用
        form.on('select(xiangmuxuanze)', function (data) {
            console.log(data.value); //得到被选中的值
            var index = $(data.elem).find("option:selected").index() - 1; // 获取选中的项目选择的index索引值
            api.project.getList({}, function (res) {
                var projectId = res[index].id; // 获取选择项目的id
                blId = projectId;
                console.log(projectId);
                api.machine.getListByProject({projectId: projectId}, function (e) { // 根据项目id请求子项目
                    console.log(e);
                    var jixingxuanze = $("#jixingxuanze");
                    jixingxuanze.empty();
                    jixingxuanze.append("<option value=''>请选择</option>");
                    for (var i = 0; i < e.length; i++) {
                        jixingxuanze.append("<option value='" + e[i].machinname + "'>" + e[i].machinname + "</option>");
                    }
                    form.render();
                });
            });
        });

        // 机型选择下拉框监听事件
        form.on('select(jixingxuanze)', function (data) {
            console.log(data.value); //得到被选中的值
            var bllId = $(data.elem).find("option:selected").index() - 1; // 机型选择索引值
            console.log(bllId);
            // 步骤条显示和隐藏
            if (data.value) {
                $("#app").removeClass("layui-hide");
            } else {
                $("#app").addClass("layui-hide");
            }
            api.machine.getListByProject({projectId: blId}, function (e) { // 根据项目id请求子项目
                console.log(e);
                vm.datass = [{name:"项目审核"}]
                // 动态添加步骤条
                for (var j = 0; j < e[bllId].machineDetail.length; j++) {
                    var fenjiebaoobj = {};
                    if (e[bllId].machineDetail[j].milepost == 1) {
                        fenjiebaoobj.name = "EVT";
                        vm.datass.push(fenjiebaoobj);
                        continue;
                    } else if (e[bllId].machineDetail[j].milepost == 2) {
                        fenjiebaoobj.name = "DVT";
                        vm.datass.push(fenjiebaoobj);
                        continue;
                    } else if (e[bllId].machineDetail[j].milepost == 3) {
                        fenjiebaoobj.name = "PVT";
                        vm.datass.push(fenjiebaoobj);
                        continue;
                    } else if (e[bllId].machineDetail[j].milepost == 4) {
                        fenjiebaoobj.name = "PMP";
                        vm.datass.push(fenjiebaoobj);
                        continue;
                    } else if (e[bllId].machineDetail[j].milepost == 5) {
                        fenjiebaoobj.name = "MP";
                        vm.datass.push(fenjiebaoobj);
                        continue;
                    }
                }
            });
        });


        // 监听搜索事件提交
        form.on('submit(formSubSearchMachine)', function (data) {
            console.log(data);
            console.log(data.field);
            return false;
        });
    });
</script>
<script>
    var vm;
    $(function () {
        vm = new Vue({
            el: '#app',
            data: {
                datass: [],
                activities: [{content: '活动按期开始'}, {content: '通过审核'}, {content: '创建成功'}]
            },
            methods: {}
        })
    })
</script>
</body>

</html>