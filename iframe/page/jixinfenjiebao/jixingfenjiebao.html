<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>项目总览</title>
    <link rel="stylesheet" href="/SKYWORTH_PMS/iframe/assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="/SKYWORTH_PMS/iframe/assets/module/admin.css?v=312"/>
    <link rel="stylesheet" href="/SKYWORTH_PMS/iframe/assets/module/step/step.css">
</head>
<body>

<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header">项目机型分解包查询</div>
        <div class="layui-card-body">
            <div class="layui-form toolbar" id="toolbarShow">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label w-auto">项目选择：</label>
                        <div class="layui-input-inline mr0">
                            <select id="xiangmuxuanze" name="xiangmuxuanze" lay-filter="xiangmuxuanze"
                                    lay-verType="tips" lay-verify="required">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label w-auto">机型选择：</label>
                        <div class="layui-input-inline mr0">
                            <select id="jixingxuanze" name="jixingxuanze" lay-filter="jixingxuanze"
                                    lay-verType="tips" lay-verify="required">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline" style="margin-left: 6px">
                        <button class="layui-btn icon-btn" lay-filter="formSubSearchMachine" lay-submit>
                            <i class="layui-icon">&#xe615;</i>搜索
                        </button>
                    </div>
                </div>
            </div>

            <!--            橙色标签线-->
            <hr class="layui-bg-green">
            <div class="layui-step" id="step">
                <div class="layui-step-content layui-clear">
                    <div class="layui-step-content-item">条目1</div>
                    <div class="layui-step-content-item">条目2</div>
                    <div class="layui-step-content-item">条目3</div>
                    <div class="layui-step-content-item">条目4</div>
                    <div class="layui-step-content-item">条目5</div>
                </div>
                <div class="layui-step-btn">
                    <div class="layui-btn-group">
                        <button class="layui-btn goFirst">第一步</button>
                        <button class="layui-btn prev">上一步</button>
                        <button class="layui-btn next">下一步</button>
                        <button class="layui-btn goLast">最后一步</button>
                        <button class="layui-btn goStep">走到第二步</button>
                        <button class="layui-btn disabled">禁用第三步</button>
                        <button class="layui-btn abled">解禁第三步</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- js部分 -->
<script type="text/javascript" src="/SKYWORTH_PMS/iframe/assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="/SKYWORTH_PMS/iframe/assets/js/jquery-2.2.4.min.js"></script>
<script type="text/javascript" src="/SKYWORTH_PMS/iframe/assets/js/common.js?v=312"></script>
<script type="text/javascript" src="/SKYWORTH_PMS/iframe/assets/js/util.js"></script>
<script type="text/javascript" src="/SKYWORTH_PMS/iframe/assets/js/api.js"></script>

<!--自定义js-->
<script>
    layui.use(['layer', 'form', 'table', 'laydate', 'admin', 'index', 'jquery','step'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form;
        var table = layui.table;
        var util = layui.util;
        var laydate = layui.laydate;
        var admin = layui.admin;
        var index = layui.index;
        var step = layui.step;

        // 项目选择下拉框渲染
        api.project.getList({}, function (e) {
            console.log(e);
            for (var i = 0; i < e.length; i++) {
                var xiangmuxuanze = $("#xiangmuxuanze");
                xiangmuxuanze.append("<option value='" + e[i].name + "'>" + e[i].name + "</option>");
            }
            form.render();
        });

        // 机型选择下拉框渲染
        form.on('select(xiangmuxuanze)', function (data) {
            console.log(data.value); //得到被选中的值
            var index = $(data.elem).find("option:selected").index() - 1; // 获取选中的项目选择的index索引值
            api.project.getList({}, function (res) {
                var projectId = res[index].id; // 获取选择项目的id
                console.log(projectId);
                api.machine.getListByProject({projectId: projectId}, function (e) { // 根据项目id请求子项目
                    console.log(e);
                    var jixingxuanze = $("#jixingxuanze");
                    jixingxuanze.empty();
                    jixingxuanze.append("<option value=''>请选择</option>");
                    for (var i = 0; i < e.length; i++) {
                        jixingxuanze.append("<option value='" + e[i].machinname + "'>" + e[i].machinname + "</option>");
                    }
                    form.render();
                });
            });
        });

        step.render({
            elem: '.layui-step',
            // title: ["第一步","第二步","第三步","第四步"],
            // description: ["aaa","bbb","ccc","ddd"],
            // currentStep: 2,
            // canIconClick: true,
            // disabledStep: [1,3],
            isOpenStepLevel: true
        });
        $(".goFirst").on("click",function() {
            step.goFirst();
        })
        $(".prev").on("click",function() {
            step.prev();
        })
        $(".next").on("click",function() {
            step.next();
        })
        $(".goLast").on("click",function() {
            step.goLast();
        })
        $(".goStep").on("click",function() {
            step.goStep(2);
        })
        $(".disabled").on("click",function() {
            step.disabled(3);
        })
        $(".abled").on("click",function() {
            step.abled(3);
        })

        // 监听搜索事件提交
        form.on('submit(formSubSearchMachine)', function (data) {
            console.log(data);
            console.log(data.field);

            return false;
        });
    });
</script>
</body>

</html>